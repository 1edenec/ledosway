#!/bin/bash

PID="1283"
ICON_VOL_HIGH="notification-audio-volume-high"
ICON_VOL_MED="notification-audio-volume-medium"
ICON_VOL_LOW="notification-audio-volume-low"
ICON_VOL_MUTED="notification-audio-volume-muted"
NOTHEAD="Volume:"
INCR=5
ICON="$ICON_VOL_MUTED"
TEXT="muted"
USE_SOUND="true"


usage(){
	echo -e "Unknowm argument.\nUsage:\nvolControl <up|down|mute>"
}


get_status(){
	DEF_SINK=$(pactl get-default-sink)
	# STAT will be "no" if not Muted and "yes" if muted
	STAT=$(pactl get-sink-mute @DEFAULT_SINK@ | awk '{print$2}')
	VOLUME=$(pactl get-sink-volume @DEFAULT_SINK@ | awk '{sub(/%/,"");print $5}')
}


get_icon(){
	if (( $1 > 66 ))
	then
		ICON=$ICON_VOL_HIGH
	elif (( $1 < 33  ))
	then
		ICON=$ICON_VOL_LOW
	else
		ICON=$ICON_VOL_MED
	fi
}


mute_vol(){
	if [ $STAT != "no" ]
	then
		TEXT="$VOLUME"%
		get_icon $(echo $TEXT | sed "s|%||")
	fi
	pactl set-sink-mute @DEFAULT_SINK@ toggle
}


up_vol(){
	if [ $STAT == "no" ]
	then
		OST=$(( 100 - $VOLUME ))
		if [ $OST -le $INCR ]
		then
			pactl set-sink-volume @DEFAULT_SINK@ 100%
			TEXT="100"%
		else
			pactl set-sink-volume @DEFAULT_SINK@ +$INCR%
			TEXT="$(( VOLUME + INCR ))"%
		fi
		get_icon $(echo $TEXT | sed "s|%||")
	else
		TEXT="$VOLUME"%
	fi
}


down_vol(){
	if [ $STAT == "no" ]
	then
		if [ $VOLUME -le $INCR ]
		then
			pactl set-sink-volume @DEFAULT_SINK@ 0%
			TEXT="0"%
		else
			pactl set-sink-volume @DEFAULT_SINK@ -$INCR%
			TEXT="$(( VOLUME - INCR ))"%
		fi
		get_icon $(echo $TEXT | sed "s|%||")
	else
		TEXT="$VOLUME"%
	fi
}


message(){
    dunstify -i $ICON  -r $PID "$NOTHEAD ${TEXT}"	 -h int:value:${TEXT}
}


bip(){
	pw-play ~/.local/share/themes/bell.oga
}


get_status

case  $1 in
	mute)	mute_vol && message ;;
	up)		up_vol		&&	message; $USE_SOUND && bip	;;
	down)	down_vol	&&	message; $USE_SOUND && bip	;;
	*)		usage	;;
esac



